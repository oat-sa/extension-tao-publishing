define("taoPublishing/provider/authSelector",["util/url","core/dataProvider/request"],function(urlUtil,request){return{getHtml:function(params){var url=urlUtil.route("authTpl","PlatformAdmin","taoPublishing");return request(url,params,"POST")}}}),define("tpl!taoPublishing/controller/PlatformAdmin/tpl/authContainer",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"auth-container\"></div>"})}),define("taoPublishing/controller/PlatformAdmin/editor",["jquery","i18n","layout/loading-bar","ui/hider","taoPublishing/provider/authSelector","tpl!taoPublishing/controller/PlatformAdmin/tpl/authContainer"],function($,__,loadingBar,hider,authSelectorProvider,authContainerTpl){"use strict";function getAuthContainer(){var $propertyContainer=$(".content-block .auth-container");return $propertyContainer.length?$propertyContainer:($propertyContainer=$(authContainerTpl()),$(".content-block .form-toolbar").before($propertyContainer),$propertyContainer)}return{start:function start(){function toggleFields($fields,enabled){enabled?$fields.removeAttr("disabled").removeProp("disabled"):$fields.attr("disabled",!0).prop("disabled",!0)}function showAuthFormPart(){var $allForms=$container.find(".auth-form-part"),$selectedForm=$container.find("[data-auth-method=\""+this.value+"\"]");hider.hide($allForms),hider.show($selectedForm),toggleFields($allForms.find(":input"),!1),toggleFields($selectedForm.find(":input"),!0)}var $container=getAuthContainer(),$elId=$("#id"),params={};$elId.length&&(params={uri:$elId.val()}),loadingBar.start(),authSelectorProvider.getHtml(params).then(function(html){$container.html(html),$container.find(".auth-type-selector").each(showAuthFormPart).on("change",showAuthFormPart)}).catch(function(){throw new Error(__("Publishing auth configuration can not be loaded"))}).then(function(){loadingBar.stop()})}}}),define("taoPublishing/controller/Publish/selectRemoteEnvironments",["jquery","i18n","layout/actions","ui/feedback","ui/taskQueue/taskQueue","layout/loading-bar"],function($,__,actionManager,feedback,taskQueue,loadingBar){"use strict";const refreshTree=function refreshTree(uriResource){actionManager.trigger("refresh",{uri:uriResource})},initCheckboxes=function initCheckboxes(){const $form=$("#publish-remote"),$checkboxes=$("input[name=\"remote-environments[]\"]",$form).not(":disabled"),$ul=$("ul",$form);if($checkboxes.length){const $checkAll=$("<input type=\"checkbox\" id=\"all-env\" title=\""+__("All active environments")+"\">");$checkAll.off("click").on("click",function(){$checkboxes.prop("checked",$(this).prop("checked"))}),$checkAll.insertBefore($ul),$("<label for=\"all-env\"><b>"+__("All active environments")+"</b></label>").insertBefore($ul)}},redeclarePublishBtn=function redeclarePublishBtn(){const $publishBtn=$("#publish-to-remote"),$form=$("#publish-remote"),$treePublishButton=$("#delivery-remote-publish");$form.on("submit",function(e){return e.preventDefault(),loadingBar.start(),taskQueue.pollAllStop(),taskQueue.create($form.prop("action"),$form.serializeArray()).then(function(result){const tasksCount=result.extra.allTasks.length+1,message=__("<strong> %s </strong> task(s) have been moved to the background.",tasksCount);feedback(null,{encodeHtml:!1,timeout:{info:8e3}}).info(message),taskQueue.pollAll(!0),refreshTree($("#selected-delivery-uri").val()),loadingBar.stop()}).catch(function(err){taskQueue.pollAll(),loadingBar.stop(),feedback().error(err.message),$treePublishButton.click()}),!1}),$publishBtn.removeClass("hidden")};return{start:function start(){initCheckboxes(),redeclarePublishBtn()}}}),define("taoPublishing/controller/Publish/classRemotePublishing",["jquery","i18n","ui/dialog/alert","taoPublishing/controller/Publish/selectRemoteEnvironments"],function($,__,alertDialog,selectRemoteEnvironments){"use strict";return{start:function start(){const uriResource=$("#selected-subject-uri").val(),exceedFlag="1"===$("#class-content-exceeded").val();exceedFlag?alertDialog(__("The class can't be published.<br/><br/>The selected class contains too many deliveries allowed for a single remote publication (maximum %s).<br/>Please reorganize the deliveries or publish a class with fewer deliveries.",$("#class-content-limit").val())):selectRemoteEnvironments.start()}}}),define("taoPublishing/controller/routes",[],function(){return{PlatformAdmin:{css:"auth-selector",actions:{addInstanceForm:"controller/PlatformAdmin/editor",editInstance:"controller/PlatformAdmin/editor"}},Publish:{actions:{selectRemoteEnvironments:"controller/Publish/selectRemoteEnvironments",selectClassRemoteEnvironments:"controller/Publish/classRemotePublishing"}}}}),define("taoPublishing/loader/taoPublishing.bundle",function(){});
//# sourceMappingURL=taoPublishing.min.js.map